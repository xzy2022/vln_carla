# 性能优化配置说明

本文介绍 `src/vln_carla/drivers/main.py` 与 `CarlaEnvAdapter` 中新增的性能优化参数，以及使用注意事项。

## 参数一览（命令行）

- `--quality-level {Epic,Low}`  
  仅在本程序负责启动 CARLA 服务器时生效（通过 `--carla-path` 启动）。  
  `Low` 会关闭后处理与阴影、缩短可视距离，通常显著提升渲染性能。

- `--no-rendering`  
  启用 CARLA 的 no-rendering 模式，彻底关闭渲染。  
  注意：GPU 传感器（如相机）将返回空数据。仅适用于不依赖图像的流程。

- `--camera-width` / `--camera-height`  
  设置 RGB 相机分辨率（`image_size_x/y`），降低分辨率可减少渲染与数据传输开销。

- `--camera-sensor-tick`  
  设置相机采样间隔（秒），例如 `0.2` 表示 5Hz。  
  仅影响相机输出频率，不改变仿真主循环的 `fixed_dt`。

- `--unload-map-layers`  
  逗号分隔的图层卸载列表，例如：`Buildings,Vegetation,ParkedVehicles`。  
  适合与 `*_Opt` 分层地图配合使用，以减少场景负载。

## 建议用法

1. **只做控制/路线测试**  
   使用 `--no-rendering`，最大化仿真吞吐。
2. **需要图像但不追求画质**  
   使用 `--quality-level Low` 并降低 `--camera-width/--camera-height`。
3. **需要低频图像**  
   设置 `--camera-sensor-tick` 提高采样间隔。
4. **分层地图优化**  
   加载 `*_Opt` 地图并使用 `--unload-map-layers` 卸载建筑/植被等层。

## 注意事项

- `--quality-level` 仅在本程序启动 CARLA 服务器时生效；如果你手动启动 CARLA，该参数不会影响已运行的实例。
- `--no-rendering` 会导致相机数据为空；若任务依赖图像输入，请勿开启。
- `--camera-sensor-tick` 过大可能导致传感器数据稀疏，影响感知或学习效果。
- `--unload-map-layers` 只对支持分层的地图有效（通常为 `*_Opt` 地图）。
